<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V2Gèšåˆå¹³å°æ¨¡æ‹Ÿå™¨ - è®¾ç½®</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <style>
        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 24px;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 28px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .settings-section {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .section-content {
            padding: 24px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .setting-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* å¼€å…³æ ·å¼ */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 32px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1890ff;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #1890ff;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .setting-control input,
        .setting-control select {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .setting-control input:focus,
        .setting-control select:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #1890ff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #40a9ff;
        }

        .btn-danger {
            background-color: #ff4d4f;
            color: white;
        }

        .btn-danger:hover {
            background-color: #ff7875;
        }

        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 24px;
            text-align: center;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            margin: 0 auto 16px;
        }

        .user-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .user-email {
            font-size: 14px;
            opacity: 0.8;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .setting-control {
                width: 100%;
            }

            .setting-control input,
            .setting-control select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="navbar">
        <div class="navbar-title">V2Gèšåˆå¹³å°</div>
        <div class="navbar-menu">
            <a href="index.html" class="navbar-link">é¦–é¡µ</a>
            <a href="cars.html" class="navbar-link">è½¦è¾†ç®¡ç†</a>
            <a href="v2g.html" class="navbar-link">å……æ”¾ç”µæ§åˆ¶</a>
            <a href="tasks.html" class="navbar-link">ä»»åŠ¡ç®¡ç†</a>
            <a href="settings.html" class="navbar-link active">è®¾ç½®</a>
        </div>
        <div class="navbar-icon" id="userIcon">
            <span class="icon">ğŸ‘¤</span>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="settings-container">
        <div class="page-header">
            <h2>è®¾ç½®</h2>
        </div>

        <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
        <div class="user-info-card">
            <div class="user-avatar">ğŸ‘¤</div>
            <div class="user-name" id="username">ç”¨æˆ·å</div>
            <div class="user-email" id="useremail">user@example.com</div>
        </div>

        <!-- è´¦æˆ·è®¾ç½® -->
        <div class="settings-section">
            <div class="section-header">è´¦æˆ·è®¾ç½®</div>
            <div class="section-content">
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ç”¨æˆ·å</div>
                        <div class="setting-description">ä¿®æ”¹æ‚¨çš„æ˜¾ç¤ºåç§°</div>
                    </div>
                    <div class="setting-control">
                        <input type="text" id="new-username" placeholder="è¾“å…¥æ–°ç”¨æˆ·å">
                        <button class="btn btn-primary" onclick="updateUsername()">ä¿å­˜</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">é‚®ç®±åœ°å€</div>
                        <div class="setting-description">ä¿®æ”¹æ‚¨çš„é‚®ç®±åœ°å€</div>
                    </div>
                    <div class="setting-control">
                        <input type="email" id="new-email" placeholder="è¾“å…¥æ–°é‚®ç®±">
                        <button class="btn btn-primary" onclick="updateEmail()">ä¿å­˜</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">å¯†ç </div>
                        <div class="setting-description">ä¿®æ”¹æ‚¨çš„ç™»å½•å¯†ç </div>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-primary" onclick="changePassword()">ä¿®æ”¹å¯†ç </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€šçŸ¥è®¾ç½® -->
        <div class="settings-section">
            <div class="section-header">é€šçŸ¥è®¾ç½®</div>
            <div class="section-content">
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ä»»åŠ¡æé†’</div>
                        <div class="setting-description">æ¥æ”¶ä»»åŠ¡æ‰§è¡Œé€šçŸ¥</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="notification-tasks" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ç”µé‡æé†’</div>
                        <div class="setting-description">å½“è½¦è¾†ç”µé‡ä½äºé˜ˆå€¼æ—¶é€šçŸ¥</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="notification-battery" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ç³»ç»Ÿé€šçŸ¥</div>
                        <div class="setting-description">æ¥æ”¶ç³»ç»Ÿæ›´æ–°å’Œé‡è¦é€šçŸ¥</div>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="notification-system" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- V2Gè®¾ç½® -->
        <div class="settings-section">
            <div class="section-header">V2Gè®¾ç½®</div>
            <div class="section-content">
                <div class="setting-item">
                    <div>
                        <div class="setting-label">é»˜è®¤åŠŸç‡è®¾ç½®</div>
                        <div class="setting-description">è®¾ç½®é»˜è®¤å……æ”¾ç”µåŠŸç‡</div>
                    </div>
                    <div class="setting-control">
                        <input type="number" id="default-power" placeholder="é»˜è®¤åŠŸç‡ (kW)" min="0" step="0.1" value="15">
                        <button class="btn btn-primary" onclick="updateDefaultPower()">ä¿å­˜</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ç”µé‡ä¿æŠ¤é˜ˆå€¼</div>
                        <div class="setting-description">è®¾ç½®æœ€å°æ”¾ç”µç”µé‡ç™¾åˆ†æ¯”</div>
                    </div>
                    <div class="setting-control">
                        <input type="number" id="min-battery" placeholder="æœ€å°ç”µé‡ (%)" min="0" max="100" value="20">
                        <button class="btn btn-primary" onclick="updateMinBattery()">ä¿å­˜</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">æ•°æ®æ›´æ–°é¢‘ç‡</div>
                        <div class="setting-description">è®¾ç½®å®æ—¶æ•°æ®æ›´æ–°é—´éš”</div>
                    </div>
                    <div class="setting-control">
                        <select id="update-frequency">
                            <option value="3000">3ç§’</option>
                            <option value="5000" selected>5ç§’</option>
                            <option value="10000">10ç§’</option>
                            <option value="30000">30ç§’</option>
                        </select>
                        <button class="btn btn-primary" onclick="updateUpdateFrequency()">ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…³äº -->
        <div class="settings-section">
            <div class="section-header">å…³äº</div>
            <div class="section-content">
                <div class="setting-item">
                    <div>
                        <div class="setting-label">ç‰ˆæœ¬</div>
                        <div class="setting-description">å½“å‰åº”ç”¨ç‰ˆæœ¬</div>
                    </div>
                    <div class="setting-control">
                        <span style="color: var(--text-secondary); font-size: 16px;">v1.0.0</span>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">å¼€å‘è€…</div>
                        <div class="setting-description">V2Gèšåˆå¹³å°å¼€å‘å›¢é˜Ÿ</div>
                    </div>
                    <div class="setting-control">
                        <span style="color: var(--text-secondary); font-size: 16px;">Â© 2025</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€€å‡ºç™»å½• -->
        <div class="settings-section">
            <div class="section-content">
                <button class="btn btn-danger" onclick="logout()" style="width: 100%; padding: 16px; font-size: 16px;">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="scripts/common.js"></script>
    <script>
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initPage();
        });

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            loadUserInfo();
            loadSettings();
        }

        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        function loadUserInfo() {
            const user = getAppData().currentUser || {
                username: 'æµ‹è¯•ç”¨æˆ·',
                email: 'test@example.com'
            };
            document.getElementById('username').textContent = user.username;
            document.getElementById('useremail').textContent = user.email;
            document.getElementById('new-username').value = user.username;
            document.getElementById('new-email').value = user.email;
        }

        // åŠ è½½è®¾ç½®
        function loadSettings() {
            // ä»localStorageåŠ è½½è®¾ç½®
            const settings = JSON.parse(localStorage.getItem('v2g_settings')) || {};
            document.getElementById('notification-tasks').checked = settings.notificationTasks !== false;
            document.getElementById('notification-battery').checked = settings.notificationBattery !== false;
            document.getElementById('notification-system').checked = settings.notificationSystem !== false;
            document.getElementById('default-power').value = settings.defaultPower || 15;
            document.getElementById('min-battery').value = settings.minBattery || 20;
            document.getElementById('update-frequency').value = settings.updateFrequency || 5000;
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const settings = {
                notificationTasks: document.getElementById('notification-tasks').checked,
                notificationBattery: document.getElementById('notification-battery').checked,
                notificationSystem: document.getElementById('notification-system').checked,
                defaultPower: parseFloat(document.getElementById('default-power').value),
                minBattery: parseInt(document.getElementById('min-battery').value),
                updateFrequency: parseInt(document.getElementById('update-frequency').value)
            };
            localStorage.setItem('v2g_settings', JSON.stringify(settings));
            showNotification('è®¾ç½®å·²ä¿å­˜ï¼', 'success');
        }

        // æ›´æ–°ç”¨æˆ·å
        function updateUsername() {
            const newUsername = document.getElementById('new-username').value;
            if (newUsername.trim()) {
                const user = getAppData().currentUser;
                if (user) {
                    user.username = newUsername;
                    setAppData('currentUser', user);
                    saveUser(user);
                    loadUserInfo();
                    showNotification('ç”¨æˆ·åå·²æ›´æ–°ï¼', 'success');
                }
            }
        }

        // æ›´æ–°é‚®ç®±
        function updateEmail() {
            const newEmail = document.getElementById('new-email').value;
            if (newEmail.trim() && /^[^s@]+@[^s@]+.[^s@]+$/.test(newEmail)) {
                const user = getAppData().currentUser;
                if (user) {
                    user.email = newEmail;
                    setAppData('currentUser', user);
                    saveUser(user);
                    loadUserInfo();
                    showNotification('é‚®ç®±å·²æ›´æ–°ï¼', 'success');
                }
            } else {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€ï¼', 'error');
            }
        }

        // ä¿®æ”¹å¯†ç 
        function changePassword() {
            // è¿™é‡Œå¯ä»¥æ‰“å¼€ä¿®æ”¹å¯†ç æ¨¡æ€æ¡†
            showNotification('ä¿®æ”¹å¯†ç åŠŸèƒ½å¼€å‘ä¸­ï¼', 'info');
        }

        // æ›´æ–°é»˜è®¤åŠŸç‡
        function updateDefaultPower() {
            const defaultPower = parseFloat(document.getElementById('default-power').value);
            if (defaultPower > 0) {
                saveSettings();
            } else {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„åŠŸç‡å€¼ï¼', 'error');
            }
        }

        // æ›´æ–°æœ€å°ç”µé‡
        function updateMinBattery() {
            const minBattery = parseInt(document.getElementById('min-battery').value);
            if (minBattery >= 0 && minBattery <= 100) {
                saveSettings();
            } else {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µé‡å€¼ï¼ˆ0-100ï¼‰ï¼', 'error');
            }
        }

        // æ›´æ–°æ•°æ®æ›´æ–°é¢‘ç‡
        function updateUpdateFrequency() {
            saveSettings();
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                clearUser();
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>